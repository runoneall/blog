<!DOCTYPE html>
<html lang="zh">
    <head>
        <!-- base -->
<meta charset="UTF-8" />
<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="template" content="Old-Fasion-Theme" />

<!-- sitemap -->
<link
    rel="sitemap"
    type="application/xml"
    title="sitemap"
    href="/sitemap.xml"
/>

<!-- title -->
<title>
    简易订阅整合工具 | Runoneall
</title>

<!-- css dependencies -->

<link rel="stylesheet" href="/css/normalize.css">
<link rel="stylesheet" href="/css/grid.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/global.css">
<link rel="stylesheet" href="/css/sidebar.css">
<link rel="stylesheet" href="/css/post.css">
<link rel="stylesheet" href="/css/misc.css">
<link rel="stylesheet" href="/css/page.css">
<link rel="stylesheet" href="/css/footer.css">
<link rel="stylesheet" href="/css/dark.css" id="dark-style" disabled>


<!-- favicon -->
<link rel="shortcut icon" href="https://dev.oneall.eu.org/favicon.webp">

<!-- extra css -->


<!-- keywords -->

<meta name="keywords" content="Hexo,Blog,Runoneall" />

<!-- description -->

<meta name="description" content="一个用php写的简易订阅整合支持：合并订阅，零散节点，去重，以普通或base64格式返回 &lt;?php  function response($code, $message, $header = &quot;&quot;) {     http_response_code($code);     if ($header != &quot;&quot;) {         header($he" />

<!-- rss -->
<link rel="alternate" href="/rss2.xml" title="RSS 2.0" type="application/application/rss+xml+xml">
<link rel="alternate" href="/atom.xml" title="ATOM 1.0" type="application/application/atom+xml+xml">

    <meta name="generator" content="Hexo 8.0.0"><link rel="alternate" href="/atom.xml" title="Runoneall" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="Runoneall" type="application/rss+xml">
</head>

    <body>
        <div id="outbox">
            <!-- header -->
            <div id="header" class="clearfix">
                <div class="container">
                    <div class="row">
                        <div class="site-name">
                            <a id="logo" href="/"
                                >Runoneall</a
                            >
                            <p
                                id="description_random_intro"
                                class="description"
                            >
                                Runoneall's Blog
                            </p>
                            <script>
                                var description_random_intro =
                                    document.getElementById(
                                        "description_random_intro",
                                    );
                                var descriptions = JSON.parse(
                                    `["路漫漫其修远兮，吾将上下而求索","天将降大任于是人也，必先苦其心志，劳其筋骨，饿其体肤，空乏其身，行拂乱其所为","惜秦皇汉武，略输文采；唐宗宋祖，稍逊风骚。俱往矣，数风流人物，还看今朝。"]`,
                                );
                                var random_intro =
                                    descriptions[
                                        Math.floor(
                                            Math.random() * descriptions.length,
                                        )
                                    ];
                                description_random_intro.innerHTML =
                                    random_intro;
                            </script>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end header -->

            <!-- sidebar button -->
            <button id="side-btn" onclick="changeSideStatus()">
                <input id="side-flag" type="checkbox" />
                <label id="side-control" for="side-flag">≡</label>
            </button>

            <!-- left area -->
            <div id="left">
                <!-- left links -->
                <div id="left-links">
                    <!-- page links -->
                    <a
                        class=""
                        href="/"
                        >首页</a
                    >
                    
                    <br />
                    <a
                        class=""
                        href="/about/index.html"
                        >关于</a
                    >
                    
                    <br />
                    <a
                        class=""
                        href="/search/index.html"
                        >搜索</a
                    >
                    
                    <br />
                    <a
                        class=""
                        href="/links/index.html"
                        >链接</a
                    >
                    
                    <!-- end page links -->

                    <!-- sidebar extra html -->
                    
                    <br />
                    <a href="/rss2.xml">RSS</a><br>
<a href="/sitemap.xml">Sitemap</a><br>
<a href="mailto:dev@oneall.eu.org">Email</a><br>
                    
                    <!-- end sidebar extra html -->

                    <br /><button id="dark-btn" onclick="changeDarkMode()">
                        更换主题
                    </button>
                </div>
                <!-- end left links -->
            </div>
            <!-- end left area -->

            <!-- right area -->
            <div id="right">
                <div class="row"><div class="col-mb-12 col-8" id="main" role="main">
    <!-- article body -->
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
        <!-- post title -->
        <h1 class="post-title" itemprop="name headline">
            <a itemprop="url" href="/2025/02/11/%E7%AE%80%E6%98%93%E8%AE%A2%E9%98%85%E6%95%B4%E5%90%88%E5%B7%A5%E5%85%B7/"
                >简易订阅整合工具</a
            >
        </h1>
        <!-- end post title -->

        <!-- post meta -->
        <ul class="post-meta">
            <li itemprop="author" itemscope itemtype="http://schema.org/Person">
                作者:
                <a itemprop="name" href="#" rel="author"
                    >Tom Brown</a
                >
            </li>
            <li>
                时间:
                <time
                    itemprop="datePublished"
                    datetime="2025-02-11T07:36:54.000Z"
                    >2025-02-11</time
                >
            </li>
            
            <li>
                分类: 
                <a href="/categories/%E9%BB%98%E8%AE%A4/">
                    默认 </a
                >&nbsp;
                
            </li>
            
        </ul>
        <!-- end post meta -->

        <!-- post content -->
        <div class="post-content" itemprop="articleBody">
            <p>一个用php写的简易订阅整合<br>支持：合并订阅，零散节点，去重，以普通或base64格式返回</p>
<pre><code class="language-php">&lt;?php

function response($code, $message, $header = &quot;&quot;)
{
    http_response_code($code);
    if ($header != &quot;&quot;) {
        header($header);
    }
    echo $message;
    exit;
}

function download_file($url, $retry = 0)
{
    $attempt = 0;
    while ($attempt &lt;= $retry) {
        $attempt++;
        $content = @file_get_contents($url);
        if ($content !== false) {
            return $content;
        }
    }
    response(500, &quot;Failed to download file: $url&quot;, &quot;Content-Type: text/plain; charset=UTF-8&quot;);
}

function load_file_to_array($file_path)
{
    $file_content = file_get_contents($file_path);
    $file_content = str_replace(&quot;\r\n&quot;, &quot;\n&quot;, $file_content);
    $lines = explode(&quot;\n&quot;, $file_content);
    $lines = array_filter($lines);
    return $lines;
}

function load_string_to_array($string)
{
    $string = str_replace(&quot;\r\n&quot;, &quot;\n&quot;, $string);
    $lines = explode(&quot;\n&quot;, $string);
    $lines = array_filter($lines);
    return $lines;
}

function response_nodes($node_array)
{
    $content = implode(&quot;\n&quot;, $node_array);
    $query_string = isset($_SERVER[&#39;QUERY_STRING&#39;]) ? $_SERVER[&#39;QUERY_STRING&#39;] : &quot;&quot;;
    if ($query_string == &quot;base64&quot;) {
        $content = base64_encode($content);
    }
    if ($query_string == &quot;clash&quot;) {
        $options = [
            &#39;http&#39; =&gt; [
                &#39;method&#39; =&gt; &#39;POST&#39;,
                &#39;header&#39; =&gt; &#39;Content-Type: text/plain; charset=UTF-8&#39;,
                &#39;content&#39; =&gt; $content
            ]
        ];
        $context = stream_context_create($options);
        $content = file_get_contents(
            &quot;https://v2ray2clash.netlify.app/.netlify/functions/clash&quot;,
            false,
            $context
        );
    }
    response(200, $content, &quot;Content-Type: text/plain; charset=UTF-8&quot;);
}

// load sub and scatter node list
$sub_list = load_file_to_array(&quot;sub.txt&quot;);
$scatter_nodes = load_file_to_array(&quot;scatter.txt&quot;);

// get sub node list
$sub_nodes = array();
foreach ($sub_list as $sub) {
    $sub_content = download_file($sub, 3);
    if (strpos($sub_content, &quot;://&quot;) === false) {
        $sub_content = base64_decode($sub_content);
    }
    $sub_nodes = array_merge($sub_nodes, load_string_to_array($sub_content));
}

// merge sub nodes and scatter nodes
$nodes = array_merge($sub_nodes, $scatter_nodes);
$nodes = array_filter($nodes);
$nodes = array_unique($nodes);

// response
response_nodes($nodes);

?&gt;
</code></pre>
<p>在同级目录新建 <code>sub.txt</code> 放置订阅，例如</p>
<pre><code>https://sub.vip.sd/JPa6vvFgygVtNP2sGJ2r/download/nlmjj?target=V2Ray
https://fly.j-s.us.kg/api/v1/client/subscribe?token=3275fdb3e5ff32434a293ca8ca8fe9dc
</code></pre>
<p>在同级目录新建 <code>scatter.txt</code> 放置零散节点，例如</p>
<pre><code>ss://YWVzLTI1Ni1nY206NmQwNDMwNDEtOTY3Ni0zNDllLWE3MDYtMzgwYWY5NGUwNjJh@c9pwn-g01.fr01-ae5.entry.v50307shvkaa.art:20065#%E6%B3%95%E5%9B%BDW01
ss://YWVzLTI1Ni1nY206NmQwNDMwNDEtOTY3Ni0zNDllLWE3MDYtMzgwYWY5NGUwNjJh@kn183-g01.us01-ae5.entry.v50307shvkaa.art:20010#%E7%BE%8E%E5%9B%BDW01
ss://YWVzLTI1Ni1nY206NmQwNDMwNDEtOTY3Ni0zNDllLWE3MDYtMzgwYWY5NGUwNjJh@b0sdx-g01.ua01-ae5.entry.v50307shvkaa.art:20070#%E4%B9%8C%E5%85%8B%E5%85%B0W01
ss://YWVzLTI1Ni1nY206NmQwNDMwNDEtOTY3Ni0zNDllLWE3MDYtMzgwYWY5NGUwNjJh@uh4r9-g01.us02-ae5.entry.v50307shvkaa.art:20015#%E7%BE%8E%E5%9B%BDW02
ss://YWVzLTI1Ni1nY206NmQwNDMwNDEtOTY3Ni0zNDllLWE3MDYtMzgwYWY5NGUwNjJh@5e3gk-g01.de01-ae5.entry.v50307shvkaa.art:20050#%E5%BE%B7%E5%9B%BDW01
ss://YWVzLTI1Ni1nY206NmQwNDMwNDEtOTY3Ni0zNDllLWE3MDYtMzgwYWY5NGUwNjJh@6tfkp-g01.ar01-ae5.entry.v50307shvkaa.art:20025#%E9%98%BF%E6%A0%B9%E5%BB%B7W01
ss://YWVzLTI1Ni1nY206NmQwNDMwNDEtOTY3Ni0zNDllLWE3MDYtMzgwYWY5NGUwNjJh@tsh16-g01.ru01-ae5.entry.v50307shvkaa.art:20030#%E4%BF%84%E7%BD%97%E6%96%AFW01
ss://YWVzLTI1Ni1nY206NmQwNDMwNDEtOTY3Ni0zNDllLWE3MDYtMzgwYWY5NGUwNjJh@13uc8-g01.tr01-ae5.entry.v50307shvkaa.art:20035#%E5%9C%9F%E8%80%B3%E5%85%B6W01
</code></pre>
<p>默认url格式，要以base64返回应增加 <code>?base64</code> 后缀<br>clash配置应增加 <code>?clash</code> 后缀<br>demo: <a target="_blank" rel="noopener" href="https://runoneall.serv00.net/NodeShare/">https://runoneall.serv00.net/NodeShare/</a></p>

        </div>
        <!-- end post content -->
    </article>
    <!-- end article body -->
</div>
</div>
            </div>
            <!-- end right area -->

            <!-- footer -->
            <div id="footer" role="contentinfo">
                &copy; 2025
                <a href="/">Runoneall</a>.
                <a target="_blank" rel="noopener" href="https://github.com/runoneall/blog/tree/theme"
                    >Old Fasion</a
                >
                Theme. Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>.
            </div>
            <!-- end footer -->
        </div>
        <!-- end outbox -->

        <!-- extra html -->


<!-- extra js -->

<script>
    console.log(String.raw`
            ___              __
      _____<  /____ _   ____/ /___  _   __
     / ___// // __ `+ "`" + String.raw`/  / __  // _ \| | / /
    / /   / // /_/ /  / /_/ //  __/| |/ /
   /_/   /_/ \__,_/   \__,_/ \___/ |___/

LET THE UNFAIRNESS OF THE WORLD BOW BEFORE ME
`)
</script>


<!-- js dependencies -->

<script src="/js/dark.js"></script>
<script src="/js/highlight.js"></script>
<script src="/js/sidebar.js"></script>


<!-- code highlight -->
<script>
    hljs.highlightAll();
</script>

    </body>
</html>
