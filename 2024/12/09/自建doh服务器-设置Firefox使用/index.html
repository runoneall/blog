<!DOCTYPE html>
<html lang="zh">
    <head>
        <!-- base -->
<meta charset="UTF-8" />
<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="template" content="Old-Fasion-Theme" />

<!-- sitemap -->
<link
    rel="sitemap"
    type="application/xml"
    title="sitemap"
    href="/sitemap.xml"
/>

<!-- title -->
<title>
    自建doh服务器+设置Firefox使用 | Runoneall
</title>

<!-- css dependencies -->

<link rel="stylesheet" href="/css/normalize.css">
<link rel="stylesheet" href="/css/grid.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/global.css">
<link rel="stylesheet" href="/css/sidebar.css">
<link rel="stylesheet" href="/css/post.css">
<link rel="stylesheet" href="/css/misc.css">
<link rel="stylesheet" href="/css/page.css">
<link rel="stylesheet" href="/css/footer.css">
<link rel="stylesheet" href="/css/dark.css" id="dark-style" disabled>


<!-- favicon -->
<link rel="shortcut icon" href="https://dev.oneall.eu.org/favicon.webp">

<!-- extra css -->


<!-- keywords -->

<meta name="keywords" content="Hexo,Blog,Runoneall" />

<!-- description -->

<meta name="description" content="前情提要 本教程不会详细解释各名词含义, 需要了解自行搜索 本教程有些步骤需要自行搜索, 肯定都有答案, 站长不想再写一遍 本教程站长亲测可用, 但因网络环境差异不保证可用性 本教程适用于Android, 但也支持其他平台(可能会有出入)  准备 Cloudflare账号 Github账号 Android手机 (可选) Google Play (可选) 一个域名 (可选) VPN (必须) 脑子与" />

<!-- rss -->
<link rel="alternate" href="/rss2.xml" title="RSS 2.0" type="application/application/rss+xml+xml">
<link rel="alternate" href="/atom.xml" title="ATOM 1.0" type="application/application/atom+xml+xml">

    <meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/atom.xml" title="Runoneall" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="Runoneall" type="application/rss+xml">
</head>

    <body>
        <div id="outbox">
            <!-- header -->
            <div id="header" class="clearfix">
                <div class="container">
                    <div class="row">
                        <div class="site-name">
                            <a id="logo" href="/"
                                >Runoneall</a
                            >
                            <p
                                id="description_random_intro"
                                class="description"
                            >
                                Runoneall's Blog
                            </p>
                            <script>
                                var description_random_intro =
                                    document.getElementById(
                                        "description_random_intro",
                                    );
                                var descriptions = JSON.parse(
                                    `["路漫漫其修远兮，吾将上下而求索","天将降大任于是人也，必先苦其心志，劳其筋骨，饿其体肤，空乏其身，行拂乱其所为","惜秦皇汉武，略输文采；唐宗宋祖，稍逊风骚。俱往矣，数风流人物，还看今朝。"]`,
                                );
                                var random_intro =
                                    descriptions[
                                        Math.floor(
                                            Math.random() * descriptions.length,
                                        )
                                    ];
                                description_random_intro.innerHTML =
                                    random_intro;
                            </script>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end header -->

            <!-- sidebar button -->
            <button id="side-btn" onclick="changeSideStatus()">
                <input id="side-flag" type="checkbox" />
                <label id="side-control" for="side-flag">≡</label>
            </button>

            <!-- left area -->
            <div id="left">
                <!-- left links -->
                <div id="left-links">
                    <!-- page links -->
                    <a
                        class=""
                        href="/"
                        >首页</a
                    >
                    
                    <br />
                    <a
                        class=""
                        href="/about/index.html"
                        >关于</a
                    >
                    
                    <br />
                    <a
                        class=""
                        href="/links/index.html"
                        >链接</a
                    >
                    
                    <br />
                    <a
                        class=""
                        href="/shortlink/index.html"
                        >短链</a
                    >
                    
                    <br />
                    <a
                        class=""
                        href="/search/index.html"
                        >搜索</a
                    >
                    
                    <!-- end page links -->

                    <!-- sidebar extra html -->
                    
                    <br />
                    <a href="/rss2.xml">RSS</a><br>
<a href="/sitemap.xml">Sitemap</a><br>
<a href="mailto:dev@oneall.eu.org">Email</a><br>
                    
                    <!-- end sidebar extra html -->

                    <br /><button id="dark-btn" onclick="changeDarkMode()">
                        更换主题
                    </button>
                </div>
                <!-- end left links -->
            </div>
            <!-- end left area -->

            <!-- right area -->
            <div id="right">
                <div class="row"><div class="col-mb-12 col-8" id="main" role="main">
    <!-- article body -->
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
        <!-- post title -->
        <h1 class="post-title" itemprop="name headline">
            <a itemprop="url" href="/2024/12/09/%E8%87%AA%E5%BB%BAdoh%E6%9C%8D%E5%8A%A1%E5%99%A8-%E8%AE%BE%E7%BD%AEFirefox%E4%BD%BF%E7%94%A8/"
                >自建doh服务器+设置Firefox使用</a
            >
        </h1>
        <!-- end post title -->

        <!-- post meta -->
        <ul class="post-meta">
            <li itemprop="author" itemscope itemtype="http://schema.org/Person">
                作者:
                <a itemprop="name" href="#" rel="author"
                    >Tom Brown</a
                >
            </li>
            <li>
                时间:
                <time
                    itemprop="datePublished"
                    datetime="2024-12-09T11:42:50.000Z"
                    >2024-12-09</time
                >
            </li>
            
            <li>
                分类: 
                <a href="/categories/%E9%BB%98%E8%AE%A4/">
                    默认 </a
                >&nbsp;
                
            </li>
            
        </ul>
        <!-- end post meta -->

        <!-- post content -->
        <div class="post-content" itemprop="articleBody">
            <h1 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h1><ul>
<li>本教程不会详细解释各名词含义, 需要了解自行搜索</li>
<li>本教程有些步骤需要自行搜索, 肯定都有答案, 站长不想再写一遍</li>
<li>本教程站长亲测可用, 但因网络环境差异不保证可用性</li>
<li>本教程适用于Android, 但也支持其他平台(可能会有出入)</li>
</ul>
<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><ul>
<li>Cloudflare账号</li>
<li>Github账号</li>
<li>Android手机</li>
<li>(可选) Google Play</li>
<li>(可选) 一个域名</li>
<li>(可选) VPN</li>
<li>(必须) 脑子与眼睛</li>
</ul>
<h1 id="搭建doh"><a href="#搭建doh" class="headerlink" title="搭建doh"></a>搭建doh</h1><ol>
<li>进入Github</li>
<li>Fork仓库: <a target="_blank" rel="noopener" href="https://github.com/tina-hello/doh-cf-workers">tina-hello&#x2F;doh-cf-workers</a></li>
<li>等待完成</li>
<li>从 README 中找到 <code>Deploy with Workers</code></li>
<li>跟随提示完成操作</li>
<li>打开 <code>Pages and Workers</code> 页面</li>
<li>找到名为 <code>doh</code> 的Worker并点击</li>
<li>点击编辑代码, 找到名为<code>path</code>的全局变量<ul>
<li><code>path</code>: 入口点, 默认为允许所有, 但所有人可用, 建议改为 <code>/</code>+<code>随便填, 必须为英文</code></li>
</ul>
</li>
<li>(如果有域名且绑定到了CF) 退出编辑, 转到 <code>设置</code> - <code>触发器</code> - <code>自定义域</code> - <code>添加自定义域</code> 绑定自定义域</li>
<li>将 <code>Worker地址</code> 与 <code>第8步修改的路径</code> 拼接在一起就是你的 <code>doh服务器地址</code></li>
<li>返回Github, 转到存储库页面, 点击 <code>Action</code>, 把里面你能找到的所有记录都删掉 (如果你不想公开你的doh服务器地址)</li>
</ol>
<h1 id="设置Firefox"><a href="#设置Firefox" class="headerlink" title="设置Firefox"></a>设置Firefox</h1><ol>
<li>此章节参考: <a target="_blank" rel="noopener" href="https://blog.17lai.site/posts/ec2cad2">ESNI和加密DNS - 保护信息隐私的最后一块拼图</a></li>
<li>从 <code>Google Play</code> 上安装最新版的 <code>Firefox Nightly</code> 应用 (或你知道的其他地方) (<a target="_blank" rel="noopener" href="https://www.mozilla.org/zh-CN/firefox/nightly/all/">官方网站</a>)</li>
<li>打开Firefox Nightly, 完成一些设置后在地址栏输入 <code>about:config</code><ol>
<li>点击上方搜索框</li>
<li>输入 <code>network.trr.mode</code> 将数值改为3或2 (<code>0</code>对应的是不开启此功能; <code>1</code>对应的是交由浏览器选择DoH与传统方式那种更快; <code>2</code>代表优先使用加密DNS查询, 如果失败则回落到普通DNS查询; <code>3</code>代表只使用加密DNS查询; <code>5</code>代表明确的关闭此功能)</li>
<li>输入 <code>network.trr.uri</code> 并输入之前获取的doh服务器地址</li>
<li>输入 <code>network.security.esni.enabled</code> (默认没有, 点击新建) 类型选 <code>布尔值</code>, 值为 <code>true</code></li>
<li>所有更改会自动保存, 可以通过刷新页面查看是否保存</li>
</ol>
</li>
<li>完全退出Firefox Nightly后重新打开, 更改生效</li>
<li>完成, 可前往 <a target="_blank" rel="noopener" href="https://encryptedsni.com/">在线检测页面</a> 查看效果, 点击 <code>检测我的浏览器</code> 并看到四个对勾即为成功</li>
</ol>

        </div>
        <!-- end post content -->
    </article>
    <!-- end article body -->
</div>
</div>
            </div>
            <!-- end right area -->

            <!-- footer -->
            <div id="footer" role="contentinfo">
                &copy; 2025
                <a href="/">Runoneall</a>.
                <a target="_blank" rel="noopener" href="https://github.com/runoneall/blog/tree/theme"
                    >Old Fasion</a
                >
                Theme. Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>.
            </div>
            <!-- end footer -->
        </div>
        <!-- end outbox -->

        <!-- extra html -->


<!-- extra js -->

<script>
    console.log(String.raw`
            ___              __
      _____<  /____ _   ____/ /___  _   __
     / ___// // __ `+ "`" + String.raw`/  / __  // _ \| | / /
    / /   / // /_/ /  / /_/ //  __/| |/ /
   /_/   /_/ \__,_/   \__,_/ \___/ |___/

LET THE UNFAIRNESS OF THE WORLD BOW BEFORE ME
`)
</script>


<!-- js dependencies -->

<script src="/js/dark.js"></script>
<script src="/js/highlight.js"></script>
<script src="/js/sidebar.js"></script>


<!-- code highlight -->
<script>
    hljs.highlightAll();
</script>

    </body>
</html>
